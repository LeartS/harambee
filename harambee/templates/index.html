{% extends "layout.html" %}

{% block body %}
<div class="jumbotron">
  <h1>Welcome to Harambee!</h1>
  <p>
    Benvenuto su Harambee, una piattaforma dedicata al miglioramento dei luoghi in cui vivi.
  </p>
  <br><br>
  <p>Per cominciare, cerca il tuo comune:</p>
  <div class="row">
    <div class="col-md-12">
      <div class="input-group input-group-lg">
        <input id="city" class="typeahead input-large form-control" type="search">
        <span class="input-group-btn">
          <button class="btn btn-default" type="button">Go</button>
        </span>
      </div>
    </div>
  </div>
  <script>
    window.onload = function() {
        {% raw %} cityTemplate = Hogan.compile("<h3>{{name}}</h3> {{bug_count}} segnalazioni, 18 contribuenti"); {% endraw %}
        var engine = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: {
                url: '{{ url_for('cities_preview') }}',
                filter: function(json) { return json.cities; },
            }
        });
        engine.clearPrefetchCache(); // for development
        engine.initialize();
        $('#city').typeahead({
            hint: true,
        }, {
            name: 'cities',
            displayKey: 'name',
            source: engine.ttAdapter(),
            templates: {
                suggestion: cityTemplate.render.bind(cityTemplate),
            }
        });
        $('.tt-hint').addClass('form-control');
    }
  </script>
</div>
{% endblock %}
